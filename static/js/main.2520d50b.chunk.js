(this["webpackJsonpwebrtc-tests"]=this["webpackJsonpwebrtc-tests"]||[]).push([[0],{12:function(e,t,n){},14:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var o=n(0),c=n.n(o),a=n(5),r=n.n(a),s=(n(12),n(2)),i=n.n(s),l=n(3),u=n(1),d=n(6),m=window.JitsiMeetJS;m.setLogLevel(m.logLevels.ERROR);var f={disableAudioLevels:!0,desktopSharingChromeExtId:"mbocklcggfhnbahlnepmldehdhpjfcjp",desktopSharingChromeDisabled:!1,desktopSharingChromeSources:["screen","window"],desktopSharingChromeMinExtVersion:"0.1",desktopSharingFirefoxDisabled:!0},v={hosts:{domain:"beta.meet.jit.si",muc:"conference.beta.meet.jit.si"},bosh:"https://beta.meet.jit.si/http-bind",clientNode:"https://jitsi.org/jitsimeet"},h={openBridgeChannel:!0};function E(){console.error("Connection Failed!")}function p(e){console.info("current devices",e)}var k=function e(t){var n=this,o=t.localVideoEl,c=t.remoteVideosEl;Object(d.a)(this,e),this.localVideoEl=null,this.remoteVideosEl=null,this.localTracks=[],this.remoteTracks={},this.callbacks={},this.room=null,this.isJoined=!1,this.onConnectionSuccess=function(){n.emit("readyToCall")},this.disconnect=function(){console.log("disconnect!"),n.connection.removeEventListener(m.events.connection.CONNECTION_ESTABLISHED,n.onConnectionSuccess),n.connection.removeEventListener(m.events.connection.CONNECTION_FAILED,E),n.connection.removeEventListener(m.events.connection.CONNECTION_DISCONNECTED,n.disconnect)},this.on=function(e,t){n.callbacks[e]||(n.callbacks[e]=[]),n.callbacks[e].push(t)},this.emit=function(e,t){var o=n.callbacks[e];o&&o.forEach((function(e){return e(t)}))},this.joinRoom=function(e){console.log("connecting to: ",e);var t=n.connection.initJitsiConference(e,h);n.room=t,t.on(m.events.conference.TRACK_ADDED,n.onRemoteTrack),t.on(m.events.conference.TRACK_REMOVED,(function(e){n.chooseMainVideo(),console.log("track removed!!!".concat(e)),e.containers.forEach((function(e){console.log("removing....:",e);try{n.remoteVideosEl.removeChild(e)}catch(t){}})),e.dispose(),n.chooseMainVideo()})),t.on(m.events.conference.CONFERENCE_JOINED,n.onConferenceJoined),t.on(m.events.conference.USER_JOINED,(function(e){console.log("user join"),n.remoteTracks[e]=[]})),t.on(m.events.conference.USER_LEFT,n.onUserLeft),t.on(m.events.conference.TRACK_MUTE_CHANGED,(function(e){console.log("".concat(e.getType()," - ").concat(e.isMuted()));var t=e.isMuted()?"mute":"unmute",o=e.getType();n.emit(t,{name:o,type:o,isLocal:e.isLocal()})})),t.on(m.events.conference.DISPLAY_NAME_CHANGED,(function(e,t){return console.log("".concat(e," - ").concat(t))})),t.on(m.events.conference.TRACK_AUDIO_LEVEL_CHANGED,(function(e,t){return console.log("".concat(e," - ").concat(t))})),t.on(m.events.conference.PHONE_NUMBER_CHANGED,(function(){return console.log("".concat(t.getPhoneNumber()," - ").concat(t.getPhonePin()))})),t.join()},this.onLocalTracks=function(e){n.localTracks=e,e.forEach((function(e,t){if(e.addEventListener(m.events.track.TRACK_AUDIO_LEVEL_CHANGED,(function(e){return console.log("Audio Level local: ".concat(e))})),e.addEventListener(m.events.track.LOCAL_TRACK_STOPPED,(function(){return console.log("local track stoped")})),e.addEventListener(m.events.track.TRACK_AUDIO_OUTPUT_CHANGED,(function(e){return console.log("track audio output device was changed to ".concat(e))})),"video"===e.getType()){var o=document.createElement("video");o.id="localVideo",o.autoplay=!0,n.localVideoEl.append(o),e.attach(o),n.emit("mainVideo",{track:e})}else{var c=document.createElement("audio");c.autoplay=!0,c.muted=!0,c.id="localAudio",n.localVideoEl.append(c),e.attach(c)}console.log(n.isJoined),n.isJoined&&n.room.addTrack(e)}))},this.onRemoteTrack=function(e){if(!e.isLocal())if("desktop"!==e.videoType){n.emit("stopSharingScreen",{track:e});var t=e.getParticipantId();n.remoteTracks[t]||(n.remoteTracks[t]=[]),n.remoteTracks[t].push(e),e.addEventListener(m.events.track.TRACK_AUDIO_LEVEL_CHANGED,(function(e){return console.log("Audio Level remote: ".concat(e))})),e.addEventListener(m.events.track.TRACK_MUTE_CHANGED,(function(){return console.log("remote track muted")})),e.addEventListener(m.events.track.LOCAL_TRACK_STOPPED,(function(){return console.log("remote track stoped")})),e.addEventListener(m.events.track.TRACK_AUDIO_OUTPUT_CHANGED,(function(e){return console.log("track audio output device was changed to ".concat(e))}));var o="remote"+t+e.getType();if(console.log(n.remoteVideosEl),"video"===e.getType()){var c=document.createElement("video");c.id=o,c.autoplay=!0,n.remoteVideosEl.append(c),e.attach(c),n.emit("mainVideo",{track:e})}else{var a=document.createElement("audio");a.autoplay=!0,a.id=o,n.remoteVideosEl.append(a),e.attach(a)}console.log("add the remote track")}else n.emit("sharingScreen",{track:e})},this.onConferenceJoined=function(){n.isJoined||(console.log("conference joined!"),n.isJoined=!0,n.localTracks.forEach((function(e){n.room.addTrack(e)})))},this.onUserLeft=function(e){(console.log("user left:",e),n.remoteTracks[e])&&(n.remoteTracks[e].forEach((function(t){console.log("deleting track",e,t.getType()),t.detach(document.querySelector("#remote".concat(e).concat(t.getType())))})),n.remoteTracks[e]=[],n.chooseMainVideo())},this.unload=function(){n.localTracks.forEach((function(e){e.dispose()})),n.room.leave(),n.connection.disconnect()},this.mute=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.localTracks[0].mute();case 2:case"end":return e.stop()}}),e)}))),this.unmute=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.localTracks[0].unmute();case 2:case"end":return e.stop()}}),e)}))),this.toggleVideo=Object(l.a)(i.a.mark((function e(){var t,o,c,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=n.localTracks[1])){e.next=8;break}return t.dispose(),n.localTracks.pop(),n.room.removeTrack(t),e.abrupt("return",!0);case 8:return e.next=10,m.createLocalTracks({devices:["video"]});case 10:return o=e.sent,c=Object(u.a)(o,1),a=c[0],r=document.querySelector("#localVideo"),n.localTracks.push(a),a.attach(r),n.room.addTrack(a),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e)}))),this.chooseMainVideo=function(){var e=Object.values(n.remoteTracks).flat().find((function(e){return console.log(e)||"video"===(null===e||void 0===e?void 0:e.getType())}))||n.localTracks[1];n.emit("mainVideo",{track:e})},this.shareScreen=function(){var e=n.localTracks[1];e&&(e.dispose(),n.localTracks.pop()),m.createLocalTracks({devices:["desktop"]}).then((function(e){var t=Object(u.a)(e,1)[0];n.localTracks[1]=t,n.room.addTrack(t),n.emit("sharingScreen",{track:t})}))},this.stopShareScreen=function(){var e=n.localTracks[1];e&&(e.dispose(),n.localTracks.pop()),m.createLocalTracks({devices:["video"]}).then((function(e){var t=Object(u.a)(e,1)[0],o=document.querySelector("#localVideo");t.attach(o),n.localTracks[1]=t,n.room.addTrack(t),n.emit("stopSharingScreen",{track:t}),n.chooseMainVideo()}))},this.localVideoEl=o,this.remoteVideosEl=c,m.init(f);var a=new m.JitsiConnection(null,null,v);this.connection=a,a.addEventListener(m.events.connection.CONNECTION_ESTABLISHED,this.onConnectionSuccess.bind(this)),a.addEventListener(m.events.connection.CONNECTION_FAILED,E),a.addEventListener(m.events.connection.CONNECTION_DISCONNECTED,this.disconnect.bind(this)),m.mediaDevices.addEventListener(m.events.mediaDevices.DEVICE_LIST_CHANGED,p),this.connection.connect(),m.createLocalTracks({devices:["audio","video"]}).then(this.onLocalTracks).catch((function(e){throw e}))},T=(n(14),new URLSearchParams(window.location.search).get("room"));function b(e){var t=e.active,n=e.onSubmit,a=Object(o.useState)(""),r=Object(u.a)(a,2),s=r[0],i=r[1],l=Object(o.useState)(T||""),d=Object(u.a)(l,2),m=d[0],f=d[1];return c.a.createElement("div",{className:"modal ".concat(t?"is-active":"")},c.a.createElement("div",{className:"modal-background"}),c.a.createElement("div",{className:"modal-content"},c.a.createElement("form",{className:"join-modal",onSubmit:function(e){e.preventDefault(),n({name:s,roomName:m})}},c.a.createElement("h1",{className:"title is-1"},"Enter room"),c.a.createElement("div",{className:"field"},c.a.createElement("label",{className:"label"},"Name"),c.a.createElement("div",{className:"control"},c.a.createElement("input",{className:"input is-primary",type:"text",placeholder:"John Smith",onChange:function(e){return i(e.target.value)},value:s}))),c.a.createElement("div",{className:"field"},c.a.createElement("label",{className:"label"},"Room name"),c.a.createElement("div",{className:"control"},c.a.createElement("input",{className:"input is-primary",type:"text",placeholder:"Johnsroom",onChange:function(e){return f(e.target.value)},value:m}))),c.a.createElement("div",{className:"field is-grouped"},c.a.createElement("div",{className:"control"},c.a.createElement("button",{className:"button is-link"},"Enter room"))))))}var g=function(){var e=Object(o.useState)(!1),t=Object(u.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)(!1),s=Object(u.a)(r,2),d=s[0],m=s[1],f=Object(o.useState)(!1),v=Object(u.a)(f,2),h=v[0],E=v[1],p=Object(o.useState)(!0),T=Object(u.a)(p,2),g=T[0],N=T[1],O=Object(o.useState)(!0),C=Object(u.a)(O,2),S=C[0],j=C[1],L=Object(o.useState)(""),_=Object(u.a)(L,2),A=(_[0],_[1]),w=Object(o.useState)(""),D=Object(u.a)(w,2),y=D[0],V=D[1],R=Object(o.useRef)(),I=Object(o.useRef)(),J=Object(o.useRef)(),U=Object(o.useRef)(),M=Object(o.useRef)(!1);function x(){return(x=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h?J.current.unmute():J.current.mute();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J.current.toggleVideo();case 2:t=e.sent,N(!t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(o.useEffect)((function(){if(n){var e=new k({localVideoEl:R.current,remoteVideosEl:I.current});return J.current=e,e.on("readyToCall",(function(){console.log("jajaja"),e.joinRoom(y)})),e.on("mute",(function(e){e.name;e.isLocal&&E(!0)})),e.on("unmute",(function(e){e.name,e.isLocal;E(!1)})),e.on("sharingScreen",(function(e){var t=e.track;t&&(M.current=!0,U.current.srcObject=t.stream,j(!1))})),e.on("stopSharingScreen",(function(){M.current=!1,U.current.srcObject=null})),function(){e.unload()}}}),[n]),c.a.createElement("div",{className:"App"},c.a.createElement(b,{active:!n,onSubmit:function(e){var t=e.name,n=e.roomName.toLowerCase().replace(/\s/g,"").replace(/[\W_]+/g,"");window.history.pushState(null,"roomNameFormatted","".concat(window.location.pathname,"?room=").concat(n)),V(n),A(t),a(!0)}}),c.a.createElement("div",{ref:R,className:"local-videos"}),c.a.createElement("div",{ref:I,className:"remote-videos"}),c.a.createElement("div",{className:"controls"},c.a.createElement("button",{className:"button is-danger is-rounded",onClick:function(){return x.apply(this,arguments)}},h?c.a.createElement("i",{className:"fas fa-microphone-slash"}):c.a.createElement("i",{className:"fas fa-microphone"})),c.a.createElement("button",{className:"button is-info is-rounded",onClick:function(){return P.apply(this,arguments)}},g?c.a.createElement("i",{className:"fas fa-video"}):c.a.createElement("i",{className:"fas fa-video-slash"})),c.a.createElement("button",{className:"button is-success is-rounded",onClick:function(){d?(J.current.stopShareScreen(),m(!1)):(J.current.shareScreen(),m(!0))}},d?c.a.createElement("i",{className:"fas fa-window-close"}):c.a.createElement("i",{className:"fas fa-desktop"}))),c.a.createElement("div",{className:"main-video"},c.a.createElement("video",{ref:U,autoPlay:!0,playsInline:!0,className:S?"mirror":""})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(g,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},7:function(e,t,n){e.exports=n(15)}},[[7,1,2]]]);
//# sourceMappingURL=main.2520d50b.chunk.js.map